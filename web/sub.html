<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FREE PROXY LIFETIME</title>
    <meta name="description" content="FREE | CF | PROXY | LIFETIME">
    <meta name="keywords" content="FREE | CF | PROXY | LIFETIME">
    <meta name="author" content="FREE | CF | PROXY | LIFETIME">
    <meta name="robots" content="FREE | CF | PROXY | LIFETIME">

    <!-- Open Graph Meta Tags untuk SEO Media Sosial -->
    <meta property="og:title" content="FREE | CF | PROXY | LIFETIME">
    <meta property="og:description" content="FREE | CF | PROXY | LIFETIME">
    <meta property="og:image" content="https://kere.us.kg/img/botvpn.jpg">
    <meta property="og:url" content="https://kere.us.kg/img/botvpn.jpg">
    <meta property="og:type" content="website">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="FREE | CF | PROXY | LIFETIME">
    <meta name="twitter:description" content="FREE | CF | PROXY | LIFETIME">
    <meta name="twitter:image" content="https://kere.us.kg/img/botvpn.jpg">
    <link href="https://kere.us.kg/img/botvpn.jpg" rel="icon" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flag-icon-css/css/flag-icon.min.css">
    <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.7.1/css/all.css">
  
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* CSS styles from your code */
        :root {
            --primary: #00ff88;
            --secondary: #00ffff;
            --accent: #ff00ff;
            --dark: #080c14;
            --darker: #040608;
            --light: #e0ffff;
            --card-bg: rgba(8, 12, 20, 0.95);
            --glow: 0 0 20px rgba(0, 255, 136, 0.3);
        }
        
        @keyframes rainbow {
            0% { color: red; }
            14% { color: black; }
            28% { color: black; }
            42% { color: green; }
            57% { color: blue; }
            71% { color: indigo; }
            85% { color: violet; }
            100% { color: red; }
        }
        
        /* ... (all other CSS styles from your code) ... */
        
        .flag-circle {
            display: inline-block;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <header><h1 class="quantum-title">FREE PROXY LIFETIME</h1></header>
    
    <div class="quantum-container">
        <!-- Search section -->
        <div class="search-quantum" style="display: flex; align-items: center; flex-direction: column;">
            <div style="display: flex; width: 90%;">
                <button class="button7"><a href="/api">SUB LINK</a></button>
                <input type="text" id="search-bar" placeholder="Search by IP, CountryCode, or ISP" value="" style="flex: 1; margin-top: 5px; height: 45px;"/>
                <button id="search-button" class="button7">Search</button>
            </div>
        </div>
        
        <!-- Wildcard dropdown section -->
        <div class="wildcard-dropdown">
            <a href="https://t.me/seaker877" target="_blank" rel="noopener noreferrer" style="font-family: 'Rajdhani', sans-serif;">
                <img src="https://kere.us.kg/img/tele.png" alt="menu" width="50">
            </a>
            <select id="wildcard" name="wildcard" style="width: 90px; height: 45px;">
                <option value="" selected>No Wildcard</option>
                <option value="business.blibli.com">business.blibli.com</option>
                <option value="ava.game.naver.com">ava.game.naver.com</option>
                <!-- ... other wildcard options ... -->
            </select>
            <select id="configType" name="configType" style="width: 60px; height: 45px;">
                <option value="tls" selected>TLS</option>
                <option value="non-tls">NON TLS</option>
            </select>
            <a href="https://t.me/kcepu_bot" target="_blank" rel="noopener noreferrer" style="font-family: 'Rajdhani', sans-serif;">
                <img src="https://kere.us.kg/img/bot.png" alt="menu" width="50">
            </a>
        </div>
        
        <!-- Country flags section -->
        <div class="w-full h-12 overflow-x-auto px-2 py-1 flex items-center space-x-2 shadow-lg bg-transparent border" style="border-width: 2px; border-style: solid; border-color: #008080; height: 70px; border-radius: 16px;">
            <!-- Country flags will be dynamically inserted here -->
        </div>
        
        <br>
        
        <!-- Proxy table -->
        <div class="table-wrapper">
            <table class="quantum-table">
                <thead>
                    <tr>
                        <th>IP:PORT</th>
                        <th>ISP</th>
                        <th>STATUS</th>
                        <th>VLESS</th>
                        <th>TROJAN</th>
                        <th>SHADOWSOCKS</th>
                    </tr>
                </thead>
                <tbody id="proxy-table-body">
                    <!-- Proxy data will be dynamically inserted here -->
                </tbody>
            </table>
        </div>
        
        <!-- Pagination -->
        <div class="quantum-pagination" id="pagination">
            <!-- Pagination buttons will be dynamically inserted here -->
        </div>
        
        <!-- Showing count -->
        <div style="text-align: center; margin-top: 16px; color: var(--primary); font-family: 'Rajdhani', sans-serif;">
            Showing <span id="showing-count">0</span> Proxies
        </div>
    </div>
    
    <footer class="footer">
        <h2 class="quantum-title1"><p>&copy; 2025 FREE PROXY LIFETIME</p></h2>
    </footer>

    <script>
        // Global variables
        const proxyListURL = 'https://raw.githubusercontent.com/kcepu877/bot/refs/heads/main/update_proxyip.txt';
        let cachedProxyList = [];
        let currentPage = 1;
        const configsPerPage = 30;
        let currentSearchQuery = '';
        let currentWildcard = '';
        let currentConfigType = 'tls';
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadProxyData();
            setupEventListeners();
        });
        
        // Load proxy data from the URL
        async function loadProxyData() {
            try {
                const response = await fetch(proxyListURL);
                const text = await response.text();
                cachedProxyList = text.trim().split('\n').filter(line => line.trim() !== '');
                renderProxyTable();
                updateCountryFlags();
            } catch (error) {
                console.error('Error loading proxy data:', error);
                showError('Failed to load proxy data');
            }
        }
        
        // Set up event listeners
        function setupEventListeners() {
            document.getElementById('search-button').addEventListener('click', executeSearch);
            document.getElementById('search-bar').addEventListener('keydown', (event) => {
                if (event.key === 'Enter') {
                    executeSearch();
                }
            });
            
            document.getElementById('wildcard').addEventListener('change', function() {
                currentWildcard = this.value;
                renderProxyTable();
            });
            
            document.getElementById('configType').addEventListener('change', function() {
                currentConfigType = this.value;
                renderProxyTable();
            });
        }
        
        // Execute search
        function executeSearch() {
            currentSearchQuery = document.getElementById('search-bar').value.trim();
            currentPage = 1; // Reset to first page when searching
            renderProxyTable();
        }
        
        // Filter proxies based on search query
        function filterProxies() {
            if (!currentSearchQuery) {
                return cachedProxyList;
            }
            
            return cachedProxyList.filter(config => {
                const parts = config.split(',');
                const ip = parts[0] || '';
                const port = parts[1] || '';
                const countryCode = parts[2] || '';
                const isp = parts[3] || '';
                
                if (currentSearchQuery.includes(':')) {
                    return `${ip}:${port}`.includes(currentSearchQuery);
                } else if (currentSearchQuery.length === 2) {
                    return countryCode.toLowerCase().includes(currentSearchQuery.toLowerCase());
                } else {
                    return ip.toLowerCase().includes(currentSearchQuery.toLowerCase()) ||
                           `${ip}:${port}`.includes(currentSearchQuery.toLowerCase()) ||
                           isp.toLowerCase().includes(currentSearchQuery.toLowerCase());
                }
            });
        }
        
        // Render the proxy table
        function renderProxyTable() {
            const filteredConfigs = filterProxies();
            const totalFilteredConfigs = filteredConfigs.length;
            const totalPages = Math.ceil(totalFilteredConfigs / configsPerPage);
            
            // Update showing count
            document.getElementById('showing-count').textContent = totalFilteredConfigs;
            
            // Calculate pagination
            const startIndex = (currentPage - 1) * configsPerPage;
            const endIndex = Math.min(startIndex + configsPerPage, totalFilteredConfigs);
            const visibleConfigs = filteredConfigs.slice(startIndex, endIndex);
            
            // Generate table rows
            const tableBody = document.getElementById('proxy-table-body');
            tableBody.innerHTML = '';
            
            visibleConfigs.forEach(config => {
                const parts = config.split(',');
                const ip = parts[0] || '';
                const port = parts[1] || '443';
                const countryCode = parts[2] || '';
                const isp = parts[3] || '';
                
                const row = document.createElement('tr');
                row.className = 'config-row';
                
                // Generate UUID for this config
                const uuid = generateUUIDv4();
                const wildcard = currentWildcard || window.location.hostname;
                const modifiedHostName = currentWildcard ? `${currentWildcard}.${window.location.hostname}` : window.location.hostname;
                
                // Determine config based on TLS or non-TLS
                let vlessConfig, trojanConfig, ssConfig;
                
                if (currentConfigType === 'tls') {
                    vlessConfig = `vless://${uuid}@${wildcard}:443?encryption=none&security=tls&sni=${modifiedHostName}&fp=randomized&type=ws&host=${modifiedHostName}&path=${encodeURIComponent(ip.toUpperCase())}-${port}#(${countryCode})%20${isp.replace(/\s/g,'%20')}${getFlagEmoji(countryCode)}`;
                    trojanConfig = `trojan://${uuid}@${wildcard}:443?encryption=none&security=tls&sni=${modifiedHostName}&fp=randomized&type=ws&host=${modifiedHostName}&path=${encodeURIComponent(ip.toUpperCase())}-${port}#(${countryCode})%20${isp.replace(/\s/g,'%20')}${getFlagEmoji(countryCode)}`;
                    ssConfig = `ss://${btoa(`none:${uuid}`)}%3D@${wildcard}:443?encryption=none&type=ws&host=${modifiedHostName}&path=${encodeURIComponent(ip.toUpperCase())}-${port}&security=tls&sni=${modifiedHostName}#(${countryCode})%20${isp.replace(/\s/g,'%20')}${getFlagEmoji(countryCode)}`;
                } else {
                    vlessConfig = `vless://${uuid}@${wildcard}:80?path=${encodeURIComponent(ip.toUpperCase())}-${port}&security=none&encryption=none&host=${modifiedHostName}&fp=randomized&type=ws&sni=${modifiedHostName}#(${countryCode})%20${isp.replace(/\s/g,'%20')}${getFlagEmoji(countryCode)}`;
                    trojanConfig = `trojan://${uuid}@${wildcard}:80?path=${encodeURIComponent(ip.toUpperCase())}-${port}&security=none&encryption=none&host=${modifiedHostName}&fp=randomized&type=ws&sni=${modifiedHostName}#(${countryCode})%20${isp.replace(/\s/g,'%20')}${getFlagEmoji(countryCode)}`;
                    ssConfig = `ss://${btoa(`none:${uuid}`)}%3D@${wildcard}:80?encryption=none&type=ws&host=${modifiedHostName}&path=${encodeURIComponent(ip.toUpperCase())}-${port}&security=none&sni=${modifiedHostName}#(${countryCode})%20${isp.replace(/\s/g,'%20')}${getFlagEmoji(countryCode)}`;
                }
                
                row.innerHTML = `
                    <td>${ip}:${port}</td>
                    <td class="country-cell">
                        <div class="flag-container">
                            <span>${countryCode} | ${isp}</span>
                            <span class="flag-circle flag-icon flag-icon-${countryCode.toLowerCase()}"></span>
                        </div>
                    </td>
                    <td class="proxy-status" id="status-${ip}:${port}">
                        <strong><i class="fas fa-spinner fa-spin loading-icon"></i></strong>
                        <div class="warna-text">Loading...</div>
                    </td>
                    <td class="button-cell">
                        <button class="px-3 py-1 bg-gradient-to-r from-[#bdc74d] to-[#bdc74d] text-black font-semibold border-0 rounded-md transform transition hover:scale-105" onclick="copy('${vlessConfig}')">
                            VLESS
                        </button>
                    </td>
                    <td class="button-cell">
                        <button class="px-3 py-1 bg-gradient-to-r from-[#4dbcc7] to-[#4dbcc7] text-black font-semibold border-0 rounded-md transform transition hover:scale-105" onclick="copy('${trojanConfig}')">
                            TROJAN
                        </button>
                    </td>
                    <td class="button-cell">
                        <button class="px-3 py-1 bg-gradient-to-r from-[#ff6e6e] to-[#ff6e6e] text-black font-semibold border-0 rounded-md transform transition hover:scale-105" onclick="copy('${ssConfig}')">
                            Shadowsocks
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
                
                // Check proxy status
                checkProxyStatus(ip, port);
            });
            
            // Render pagination
            renderPagination(totalPages);
        }
        
        // Check proxy status
        async function checkProxyStatus(ip, port) {
            try {
                const response = await fetch(`/check?ip=${ip}:${port}`);
                if (!response.ok) {
                    throw new Error('Failed to fetch IP information');
                }
                
                const data = await response.json();
                const statusElement = document.getElementById(`status-${ip}:${port}`);
                
                if (!statusElement) return;
                
                const status = data.status || 'UNKNOWN';
                let delay = data.delay || 'N/A';
                
                if (delay !== 'N/A') {
                    delay = parseFloat(delay.replace("ms", "").trim());
                    if (!isNaN(delay)) {
                        delay = Math.round(delay) + "ms";
                    } else {
                        delay = "N/A";
                    }
                }
                
                if (status === 'ACTIVE ✅') {
                    statusElement.innerHTML = '<i class="fas fa-bolt"></i>&nbsp;<span style="color: gold;">(' + delay + ')</span>';
                    statusElement.style.color = '#00FF00';
                } else if (status === 'DEAD ❌') {
                    statusElement.innerHTML = '<strong><i class="fas fa-times-circle"></i> DEAD</strong>';
                    statusElement.style.color = '#FF3333';
                } else if (status === 'UNKNOWN') {
                    statusElement.innerHTML = '<strong>UNKNOWN</strong>';
                    statusElement.style.color = 'gray';
                } else {
                    statusElement.innerHTML = '<strong>' + status + '</strong>';
                    statusElement.style.color = 'orange';
                }
                
                statusElement.style.fontSize = '13px';
                statusElement.style.fontWeight = 'bold';
            } catch (error) {
                console.error('Error checking proxy status:', error);
                const statusElement = document.getElementById(`status-${ip}:${port}`);
                if (statusElement) {
                    statusElement.textContent = 'Error';
                    statusElement.style.color = 'cyan';
                }
            }
        }
        
        // Render pagination
        function renderPagination(totalPages) {
            const paginationContainer = document.getElementById('pagination');
            paginationContainer.innerHTML = '';
            
            const pageRange = 2;
            
            // Previous page button
            if (currentPage > 1) {
                const prevLink = document.createElement('a');
                prevLink.href = '#';
                prevLink.className = 'pagination-arrow';
                prevLink.innerHTML = '◁';
                prevLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    currentPage--;
                    renderProxyTable();
                });
                paginationContainer.appendChild(prevLink);
            }
            
            // Page number buttons
            for (let i = Math.max(1, currentPage - pageRange); i <= Math.min(totalPages, currentPage + pageRange); i++) {
                const pageLink = document.createElement('a');
                pageLink.href = '#';
                pageLink.className = 'pagination-number' + (i === currentPage ? ' active' : '');
                pageLink.textContent = i;
                pageLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    currentPage = i;
                    renderProxyTable();
                });
                paginationContainer.appendChild(pageLink);
            }
            
            // Next page button
            if (currentPage < totalPages) {
                const nextLink = document.createElement('a');
                nextLink.href = '#';
                nextLink.className = 'pagination-arrow';
                nextLink.innerHTML = '▷';
                nextLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    currentPage++;
                    renderProxyTable();
                });
                paginationContainer.appendChild(nextLink);
            }
        }
        
        // Update country flags
        function updateCountryFlags() {
            const flagContainer = document.querySelector('.w-full.h-12.overflow-x-auto');
            if (!flagContainer) return;
            
            // Get unique country codes
            const countryCodes = [...new Set(cachedProxyList.map(config => {
                const parts = config.split(',');
                return parts[2] ? parts[2].toUpperCase() : '';
            }))].filter(code => code && code !== 'UNKNOWN');
            
            // Add flags to container
            flagContainer.innerHTML = '';
            countryCodes.forEach(code => {
                if (code) {
                    const flagLink = document.createElement('a');
                    flagLink.href = `#${code}`;
                    flagLink.className = 'py-1';
                    flagLink.innerHTML = `<span class="flag-circle flag-icon flag-icon-${code.toLowerCase()}" style="display: inline-block; width: 40px; height: 40px; margin: 2px; border: 2px solid #008080; border-radius: 50%;"></span>`;
                    flagLink.addEventListener('click', (e) => {
                        e.preventDefault();
                        document.getElementById('search-bar').value = code;
                        executeSearch();
                    });
                    flagContainer.appendChild(flagLink);
                }
            });
        }
        
        // Copy text to clipboard
        function copy(text) {
            navigator.clipboard.writeText(text)
                .then(() => {
                    Swal.fire({
                        icon: 'success',
                        background: 'rgba(6, 18, 67, 0.70)',
                        color: 'white',
                        title: 'Copied!',
                        width: '250px',
                        text: text,
                        timer: 1500,
                        showConfirmButton: false
                    });
                })
                .catch(() => {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: 'Failed to copy. Please try again!',
                    });
                });
        }
        
        // Generate UUID v4
        function generateUUIDv4() {
            const randomValues = crypto.getRandomValues(new Uint8Array(16));
            randomValues[6] = (randomValues[6] & 0x0f) | 0x40;
            randomValues[8] = (randomValues[8] & 0x3f) | 0x80;
            return [
                randomValues[0].toString(16).padStart(2, '0'),
                randomValues[1].toString(16).padStart(2, '0'),
                randomValues[2].toString(16).padStart(2, '0'),
                randomValues[3].toString(16).padStart(2, '0'),
                randomValues[4].toString(16).padStart(2, '0'),
                randomValues[5].toString(16).padStart(2, '0'),
                randomValues[6].toString(16).padStart(2, '0'),
                randomValues[7].toString(16).padStart(2, '0'),
                randomValues[8].toString(16).padStart(2, '0'),
                randomValues[9].toString(16).padStart(2, '0'),
                randomValues[10].toString(16).padStart(2, '0'),
                randomValues[11].toString(16).padStart(2, '0'),
                randomValues[12].toString(16).padStart(2, '0'),
                randomValues[13].toString(16).padStart(2, '0'),
                randomValues[14].toString(16).padStart(2, '0'),
                randomValues[15].toString(16).padStart(2, '0'),
            ].join('').replace(/^(.{8})(.{4})(.{4})(.{4})(.{12})$/, '$1-$2-$3-$4-$5');
        }
        
        // Get flag emoji from country code
        function getFlagEmoji(countryCode) {
            if (!countryCode) return '🏳';
            return countryCode
                .toUpperCase()
                .split('')
                .map(char => String.fromCodePoint(0x1f1e6 - 65 + char.charCodeAt(0)))
                .join('');
        }
        
        // Show error message
        function showError(message) {
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: message,
            });
        }
    </script>
</body>
</html>
